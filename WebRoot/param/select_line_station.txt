<jsp:useBean id="tree" scope="page" class="com.bo.jsp.Tree"/>
<%
String[] line=tree.getRoot("select distinct '('|| line_id ||')' || trim(line_nm_cn)  from tbl_metro_line_info");
int line_count=line.length;
System.out.println(line_count);
%>

<SCRIPT language=javascript>
<!--
var where = new Array(<%=line_count%>); 

function comefrom(loca,station_id){
 this.loca = loca; this.locastation_id = station_id;
} 
where[0]= new comefrom("È«Ïß","È«Õ¾");
<%
for (int i=0; i<line_count;i++){
	System.out.println(line[i]);
	String sql="select distinct '('|| station_id || ')' || trim(station_nm_cn)  from tbl_metro_station_info where line_id='"+line[i].substring(1,3)+"'";
	System.out.println(sql);
	String[] station=tree.getBranch(sql);
	int station_count=station.length;
	System.out.println(station_count);
	StringBuffer station_list=new StringBuffer();
	for (int j=0; j<station_count;j++){
		station_list.append("|");
		station_list.append(station[j]);
	}
%>
where[<%=i+1%>]=new comefrom("<%=line[i]%>","<%=station_list.toString()%>")
<%
}
%>

function select() {
	with(document.MyForm.line_id) {
		var loca2 = options[selectedIndex].value;
	 }
	for(i = 0;i < where.length;i ++){
		if (where[i].loca == loca2) {
			loca3 = (where[i].station_id).split("|");
			for(j = 0;j < loca3.length;j++) {
				with(document.MyForm.station_id) { 
					length = loca3.length;
					options[j].text = loca3[j]; 
					options[j].value = loca3[j];
					var loca4=options[selectedIndex].value;
				}
			}
		break;
		}
	}
}


function init() {
	with(document.MyForm.line_id) {
		length = where.length;
		for(k=0;k<where.length;k++) {
			options[k].text = where[k].loca;
			options[k].value = where[k].loca;
		}
		options[selectedIndex].text = where[0].loca;
		options[selectedIndex].value = where[0].loca;
	}
	with(document.MyForm.station_id) {		
		loca3 = (where[0].locastation_id).split("|");
		length = loca3.length;
		for(l=0;l<length;l++) {
			options[l].text = loca3[l];
			options[l].value = loca3[l];
		}
		options[selectedIndex].text = loca3[0];
		options[selectedIndex].value = loca3[0];
	}
}
-->
</SCRIPT>
